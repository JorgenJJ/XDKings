<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" media="screen" href="../css/stylesheet.css">
    <title>XDKings</title>
  </head>
  <body>
    <div id="header">
        <a id="back" href="index.html">Back</a>
    </div>
    <div id="leftNav">
    </div>
    <div id="article">
      <div id="launchDetails">
        <div id="tags">
          <h3 class="field">Mission name:</h3>
          <h3 class="field">Mission time:</h3>
          <h3 class="field">Status:</h3>
          <h3 class="field">Description:</h3>
        </div>
        <div id="launch">
        </div>
      </div>
    </div>
    <div id="rightNav">
    </div>
    <div id="footer">
    </div>
  </body>
  <script>
    var query = window.location.search.substring(1);
    var pair = query.split("=");
    var id = pair[1];

    const Http = new XMLHttpRequest();
    const url = 'https://launchlibrary.net/1.4/launch/' + id;
    Http.open("GET", url);
    Http.send();

    Http.onreadystatechange=function() {
      if(this.readyState==4 && this.status==200) {
        jsonParser(Http.responseText);
      }
    }

    function jsonParser(response) {
      var obj = JSON.parse(response);
      var title = document.createElement('h3');
      title.innerHTML = obj.launches[0].name;

      var date = document.createElement('p');
      date.innerHTML = obj.launches[0].windowstart;

      var statusEl = document.createElement('p');
      var status = obj.launches[0].status;
      switch (status) {
        case 1:
          statusEl.innerHTML = "Certain";
          statusEl.style = "color: #0b6317";
          break;
        case 2:
          statusEl.innerHTML = "Uncertain";
          statusEl.style = "color: #700606";
          break;
        default:
          statusEl.innerHTML = "Unknown";
          statusEl.style = "color: #1e1c1c";
          break;
      }

      var description = document.createElement('p');
      var readMore = document.createElement('a');

      description.innerHTML = obj.launches[0].missions[0].description;
      readMore.innerHTML = "Read more";
      readMore.setAttribute("href", obj.launches[0].missions[0].wikiURL);

      title.setAttribute("class", "field");
      date.setAttribute("class", "field");
      statusEl.setAttribute("class", "field");
      description.setAttribute("class", "field");


      document.getElementById("launch").appendChild(title);
      document.getElementById("launch").appendChild(date);
      document.getElementById("launch").appendChild(statusEl);
      document.getElementById("launch").appendChild(description);

      console.log(readMore.innerHTML);
      console.log(readMore.innerHTML.length);
      console.log(trim(readMore.innerHTML));
      console.log(trim(readMore.innerHTML).length);

      if (!trim(readMore.innerHTML).length == 0) {
        document.getElementById("launch").appendChild(readMore);
      }
    }
    </script>
</html>
